<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dominio de Ventas - An谩lisis DDD</title>
    <style>
        @page {
            size: A4;
            margin: 2.5cm;
        }
        
        body {
            font-family: 'Calibri', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 21cm;
            margin: 0 auto;
            padding: 20px;
            background: white;
        }
        
        .header {
            text-align: center;
            border-bottom: 3px solid #2c3e50;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            color: #7f8c8d;
            font-size: 16px;
        }
        
        h2 {
            color: #2c3e50;
            font-size: 22px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
            margin-top: 30px;
            margin-bottom: 15px;
            page-break-after: avoid;
        }
        
        h3 {
            color: #34495e;
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
            page-break-after: avoid;
        }
        
        h4 {
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 15px;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            page-break-inside: avoid;
            font-size: 11px;
        }
        
        table th {
            background-color: #3498db;
            color: white;
            padding: 10px;
            text-align: left;
            font-weight: bold;
        }
        
        table td {
            border: 1px solid #bdc3c7;
            padding: 8px;
            vertical-align: top;
        }
        
        table tr:nth-child(even) {
            background-color: #ecf0f1;
        }
        
        .code-block {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            white-space: pre-wrap;
            page-break-inside: avoid;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .toc {
            background-color: #ecf0f1;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .toc h2 {
            border: none;
            margin-top: 0;
        }
        
        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        .toc li {
            padding: 5px 0;
        }
        
        .toc a {
            color: #2c3e50;
            text-decoration: none;
        }
        
        .toc a:hover {
            color: #3498db;
            text-decoration: underline;
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 10px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        
        .button-container {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #ecf0f1;
            border-radius: 5px;
        }
        
        .download-btn {
            background-color: #3498db;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        
        .download-btn:hover {
            background-color: #2980b9;
        }
        
        @media print {
            body {
                padding: 0;
            }
            
            .button-container {
                display: none;
            }
            
            h2, h3 {
                page-break-after: avoid;
            }
            
            table, .code-block {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Dominio de Ventas</h1>
        <div class="subtitle">An谩lisis Completo - Domain-Driven Design</div>
        <div class="subtitle">Concesionario de Veh铆culos</div>
    </div>

    <div class="button-container">
        <button class="download-btn" onclick="window.print()"> Imprimir / Guardar como PDF</button>
    </div>

    <div class="toc">
        <h2>Tabla de Contenidos</h2>
        <ul>
            <li><a href="#glosario">1. Glosario de T茅rminos de Negocio (Lenguaje Ubicuo)</a></li>
            <li><a href="#objetos-valor">2. Objetos de Valor del Dominio</a></li>
            <li><a href="#eventos">3. Triggers y Eventos del Dominio</a></li>
            <li><a href="#servicios">4. Servicios del Dominio</a></li>
        </ul>
    </div>

    <div class="section" id="glosario">
        <h2>1. Glosario de T茅rminos de Negocio (Lenguaje Ubicuo)</h2>
        
        <table>
            <thead>
                <tr>
                    <th style="width: 20%">T茅rmino</th>
                    <th style="width: 45%">Definici贸n</th>
                    <th style="width: 35%">Contexto de Uso</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Cliente</strong></td>
                    <td>Persona f铆sica o jur铆dica que est谩 interesada en adquirir un veh铆culo o que ya ha realizado una compra</td>
                    <td>Identificaci贸n y seguimiento durante todo el proceso de venta</td>
                </tr>
                <tr>
                    <td><strong>Cotizaci贸n</strong></td>
                    <td>Documento que detalla el precio estimado de un veh铆culo con sus accesorios, incluyendo descuentos y condiciones de pago</td>
                    <td>Generada durante la negociaci贸n con el cliente</td>
                </tr>
                <tr>
                    <td><strong>Trade-in</strong></td>
                    <td>Veh铆culo usado que el cliente entrega como parte de pago para la adquisici贸n de un veh铆culo nuevo o seminuevo</td>
                    <td>Evaluado y valorado para ajustar el precio final</td>
                </tr>
                <tr>
                    <td><strong>AutoConfigurado</strong></td>
                    <td>Veh铆culo personalizado seg煤n las preferencias del cliente (color, accesorios, opcionales)</td>
                    <td>Resultado de la configuraci贸n durante el proceso de venta</td>
                </tr>
                <tr>
                    <td><strong>Reserva</strong></td>
                    <td>Compromiso temporal del cliente para apartar un veh铆culo espec铆fico del inventario</td>
                    <td>Requiere confirmaci贸n del inventario y posible adelanto</td>
                </tr>
                <tr>
                    <td><strong>Venta</strong></td>
                    <td>Transacci贸n comercial formalizada mediante la cual se transfiere la propiedad de un veh铆culo al cliente</td>
                    <td>Genera obligaciones de entrega y pago</td>
                </tr>
                <tr>
                    <td><strong>ContratoVenta</strong></td>
                    <td>Documento legal que establece los t茅rminos y condiciones de la transacci贸n de venta</td>
                    <td>Vincula legalmente a las partes involucradas</td>
                </tr>
                <tr>
                    <td><strong>Margen</strong></td>
                    <td>Diferencia entre el precio de venta y el costo de adquisici贸n del veh铆culo</td>
                    <td>Indicador clave de rentabilidad</td>
                </tr>
                <tr>
                    <td><strong>Descuento</strong></td>
                    <td>Reducci贸n aplicada al precio de venta seg煤n pol铆ticas comerciales o negociaci贸n</td>
                    <td>Sujeto a reglas de autorizaci贸n seg煤n monto</td>
                </tr>
                <tr>
                    <td><strong>Comisi贸n</strong></td>
                    <td>Porcentaje o monto fijo que recibe el vendedor por cerrar una venta</td>
                    <td>Calculada seg煤n pol铆ticas de compensaci贸n</td>
                </tr>
                <tr>
                    <td><strong>Precio Base</strong></td>
                    <td>Precio de referencia del veh铆culo sin configuraciones adicionales</td>
                    <td>Punto de partida para la cotizaci贸n</td>
                </tr>
                <tr>
                    <td><strong>Configuraci贸n</strong></td>
                    <td>Conjunto de opciones y accesorios seleccionados para personalizar el veh铆culo</td>
                    <td>Impacta el precio final</td>
                </tr>
                <tr>
                    <td><strong>Financiaci贸n</strong></td>
                    <td>Modalidad de pago que permite al cliente adquirir el veh铆culo mediante un cr茅dito</td>
                    <td>Opcional, requiere aprobaci贸n crediticia</td>
                </tr>
                <tr>
                    <td><strong>Promoci贸n</strong></td>
                    <td>Oferta especial temporal que incluye beneficios adicionales o descuentos</td>
                    <td>Aplica seg煤n vigencia y condiciones</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="section" id="objetos-valor">
        <h2>2. Objetos de Valor del Dominio</h2>

        <h3>2.1 Precio</h3>
        <div class="code-block">Atributos:
- MontoBase: decimal
- Moneda: string (COP, USD)
- Descuentos: List&lt;Descuento&gt;
- ImpuestosIncluidos: List&lt;Impuesto&gt;
- PrecioFinal: decimal (calculado)

Invariantes:
- PrecioFinal debe ser mayor a cero
- La suma de descuentos no puede exceder el precio base
- Moneda debe ser v谩lida seg煤n configuraci贸n regional</div>

        <h3>2.2 DatosVeh铆culo</h3>
        <div class="code-block">Atributos:
- VIN: string (煤nico, 17 caracteres)
- Marca: string
- Modelo: string
- A帽o: int
- Color: string
- Kilometraje: int
- EstadoCondici贸n: enum (Nuevo, Seminuevo, Usado)

Invariantes:
- VIN debe ser v谩lido seg煤n est谩ndar internacional
- A帽o debe estar entre 1900 y a帽o actual + 1
- Kilometraje no puede ser negativo</div>

        <h3>2.3 Configuraci贸nVeh铆culo</h3>
        <div class="code-block">Atributos:
- ColorExterior: string
- ColorInterior: string
- Accesorios: List&lt;Accesorio&gt;
- PaquetesOpcionales: List&lt;Paquete&gt;
- PrecioAdicional: decimal (calculado)

Invariantes:
- Accesorios deben ser compatibles con el modelo
- No puede haber accesorios duplicados</div>

        <h3>2.4 ValorTradeIn</h3>
        <div class="code-block">Atributos:
- Veh铆culoEntregado: DatosVeh铆culo
- ValorEstimado: decimal
- ValorAceptado: decimal
- FechaEvaluaci贸n: DateTime
- EstadoEvaluaci贸n: enum (Pendiente, Aceptado, Rechazado)

Invariantes:
- ValorAceptado <= ValorEstimado
- FechaEvaluaci贸n no puede ser futura
- ValorEstimado debe ser mayor a cero</div>

        <h3>2.5 RangoFechas</h3>
        <div class="code-block">Atributos:
- FechaInicio: DateTime
- FechaFin: DateTime

Invariantes:
- FechaFin debe ser posterior a FechaInicio
- Ambas fechas deben ser v谩lidas</div>

        <h3>2.6 DatosContacto</h3>
        <div class="code-block">Atributos:
- TipoContacto: enum (Email, Tel茅fono, Celular)
- Valor: string
- EsPrincipal: bool
- Verificado: bool

Invariantes:
- Formato debe ser v谩lido seg煤n TipoContacto
- Debe existir al menos un contacto principal</div>

        <h3>2.7 CondicionesPago</h3>
        <div class="code-block">Atributos:
- TipoPago: enum (Contado, Financiado, Mixto)
- MontoInicial: decimal
- PorcentajeInicial: decimal
- RequiereFinanciaci贸n: bool
- Plazo: int (meses, si aplica)

Invariantes:
- MontoInicial >= 0
- Si TipoPago es Contado, MontoInicial debe ser 100% del precio
- Si es Financiado, MontoInicial debe ser al menos el m铆nimo establecido</div>
    </div>

    <div class="section" id="eventos">
        <h2>3. Triggers y Eventos del Dominio</h2>

        <h3>3.1 Eventos de Entrada (Inbound)</h3>
        <table>
            <thead>
                <tr>
                    <th style="width: 25%">Evento</th>
                    <th style="width: 15%">Origen</th>
                    <th style="width: 30%">Datos</th>
                    <th style="width: 30%">Acci贸n Desencadenada</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Veh铆culoListoParaVenta</strong></td>
                    <td>Inventario</td>
                    <td>VIN, EstadoStock, PrecioSugerido</td>
                    <td>Habilitar veh铆culo en cat谩logo de ventas</td>
                </tr>
                <tr>
                    <td><strong>AprobacionCr茅dito</strong></td>
                    <td>Financiaci贸n</td>
                    <td>ClienteId, MontoAprobado, Plazo, TasaInter茅s</td>
                    <td>Continuar con formalizaci贸n de venta</td>
                </tr>
                <tr>
                    <td><strong>DatosCliente</strong></td>
                    <td>CRM</td>
                    <td>ClienteId, Nombre, Contacto, HistorialCompras</td>
                    <td>Cargar informaci贸n del cliente en cotizaci贸n</td>
                </tr>
                <tr>
                    <td><strong>RechazoCr茅dito</strong></td>
                    <td>Financiaci贸n</td>
                    <td>ClienteId, MotivoRechazo</td>
                    <td>Notificar al vendedor y cliente, ofrecer alternativas</td>
                </tr>
            </tbody>
        </table>

        <h3>3.2 Eventos de Salida (Outbound)</h3>
        <table>
            <thead>
                <tr>
                    <th style="width: 25%">Evento</th>
                    <th style="width: 20%">Destino</th>
                    <th style="width: 30%">Datos</th>
                    <th style="width: 25%">Prop贸sito</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Cotizaci贸nGenerada</strong></td>
                    <td>CRM, Cliente</td>
                    <td>Cotizaci贸nId, Veh铆culoId, PrecioTotal, Vigencia</td>
                    <td>Registro y seguimiento de propuesta comercial</td>
                </tr>
                <tr>
                    <td><strong>ReservarStock</strong></td>
                    <td>Inventario</td>
                    <td>VIN, ClienteId, FechaReserva, Duraci贸nReserva</td>
                    <td>Apartar veh铆culo temporalmente</td>
                </tr>
                <tr>
                    <td><strong>SolicitudCr茅dito</strong></td>
                    <td>Financiaci贸n</td>
                    <td>ClienteId, MontoSolicitado, Plazo, Veh铆culoId</td>
                    <td>Iniciar evaluaci贸n crediticia</td>
                </tr>
                <tr>
                    <td><strong>VentaConfirmada</strong></td>
                    <td>Finanzas, Entrega, Inventario, CRM</td>
                    <td>VentaId, ClienteId, VIN, MontoTotal, FormaPago</td>
                    <td>Activar procesos de cobro y entrega</td>
                </tr>
                <tr>
                    <td><strong>Cotizaci贸nVencida</strong></td>
                    <td>CRM</td>
                    <td>Cotizaci贸nId, ClienteId</td>
                    <td>Liberar reserva, actualizar pipeline de ventas</td>
                </tr>
                <tr>
                    <td><strong>TradeInEvaluado</strong></td>
                    <td>Inventario, Recepci贸n</td>
                    <td>Veh铆culoTradeIn, ValorAceptado, Estado</td>
                    <td>Registrar ingreso potencial de veh铆culo usado</td>
                </tr>
                <tr>
                    <td><strong>VentaCancelada</strong></td>
                    <td>Inventario, Finanzas, CRM</td>
                    <td>VentaId, Motivo</td>
                    <td>Liberar reserva, reversar registros</td>
                </tr>
            </tbody>
        </table>

        <h3>3.3 Triggers Internos</h3>
        <table>
            <thead>
                <tr>
                    <th style="width: 30%">Trigger</th>
                    <th style="width: 35%">Condici贸n</th>
                    <th style="width: 35%">Acci贸n</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>ValidarDisponibilidad</strong></td>
                    <td>Cliente selecciona veh铆culo</td>
                    <td>Consultar a Inventario si est谩 disponible</td>
                </tr>
                <tr>
                    <td><strong>CalcularPrecioFinal</strong></td>
                    <td>Se modifica configuraci贸n o descuentos</td>
                    <td>Recalcular precio total de cotizaci贸n</td>
                </tr>
                <tr>
                    <td><strong>AplicarPromoci贸n</strong></td>
                    <td>Fecha actual dentro de vigencia de promoci贸n</td>
                    <td>Aplicar descuentos o beneficios autom谩ticamente</td>
                </tr>
                <tr>
                    <td><strong>RequiereAutorizaci贸n</strong></td>
                    <td>Descuento excede l铆mite permitido</td>
                    <td>Enviar solicitud a supervisor</td>
                </tr>
                <tr>
                    <td><strong>NotificarVigencia</strong></td>
                    <td>Quedan 24h para vencimiento de cotizaci贸n</td>
                    <td>Alertar a vendedor y cliente</td>
                </tr>
                <tr>
                    <td><strong>EvaluarTradeIn</strong></td>
                    <td>Cliente solicita valoraci贸n</td>
                    <td>Crear orden de inspecci贸n para veh铆culo usado</td>
                </tr>
                <tr>
                    <td><strong>ValidarDocumentaci贸n</strong></td>
                    <td>Antes de confirmar venta</td>
                    <td>Verificar documentos requeridos del cliente</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="section" id="servicios">
        <h2>4. Servicios del Dominio</h2>

        <h3>4.1 Servicios de Aplicaci贸n</h3>

        <h4>ServicioCotizaci贸n</h4>
        <div class="code-block">Responsabilidades:
- Crear nueva cotizaci贸n
- Calcular precio total con configuraciones y descuentos
- Aplicar promociones vigentes
- Validar vigencia de cotizaci贸n
- Generar documento de cotizaci贸n

M茅todos:
+ CrearCotizaci贸n(clienteId, veh铆culoId, configuraci贸n): Cotizaci贸nId
+ CalcularPrecioTotal(cotizaci贸nId): Precio
+ AplicarDescuento(cotizaci贸nId, descuento): Result
+ RegenerarCotizaci贸n(cotizaci贸nId): Cotizaci贸n
+ ObtenerCotizacionesVigentes(clienteId): List&lt;Cotizaci贸n&gt;

Dependencias:
- Repositorio de Cotizaciones
- Servicio de Precios
- Servicio de Promociones
- Cliente API (CRM)</div>

        <h4>ServicioVenta</h4>
        <div class="code-block">Responsabilidades:
- Procesar venta completa
- Validar condiciones de venta
- Coordinar con otros bounded contexts
- Generar contrato de venta
- Gestionar estados de la venta

M茅todos:
+ IniciarVenta(cotizaci贸nId): VentaId
+ ConfirmarVenta(ventaId, condicionesPago): Result
+ CancelarVenta(ventaId, motivo): Result
+ ObtenerEstadoVenta(ventaId): EstadoVenta
+ GenerarContrato(ventaId): ContratoVenta

Dependencias:
- Repositorio de Ventas
- Servicio de Cotizaci贸n
- Inventario API
- Financiaci贸n API
- Finanzas API</div>

        <h4>ServicioTradeIn</h4>
        <div class="code-block">Responsabilidades:
- Gestionar evaluaci贸n de veh铆culos en trade-in
- Calcular valor de mercado
- Ajustar precio de venta
- Coordinar recepci贸n del veh铆culo usado

M茅todos:
+ SolicitarEvaluaci贸n(veh铆culoUsado, ventaId): Evaluaci贸nId
+ RegistrarValorEstimado(evaluaci贸nId, valor): Result
+ AceptarTradeIn(evaluaci贸nId, valorFinal): Result
+ AjustarPrecioVenta(ventaId, valorTradeIn): Precio

Dependencias:
- Repositorio de TradeIns
- Servicio de Precios
- Inspecci贸n API
- Recepci贸n API</div>

        <h3>4.2 Servicios de Dominio</h3>

        <h4>ServicioCalculoPrecio</h4>
        <div class="code-block">Responsabilidades:
- Calcular precio final con todas las variables
- Aplicar reglas de descuento
- Validar m谩rgenes m铆nimos
- Calcular comisiones

M茅todos:
+ CalcularPrecioFinal(precioBase, configuraci贸n, descuentos, tradeIn): Precio
+ ValidarDescuento(descuento, precioBase, pol铆ticasVigentes): Result
+ CalcularMargen(precioVenta, costoAdquisici贸n): Margen
+ CalcularComisi贸n(precioVenta, reglaComisi贸n): Monto

Reglas de Negocio:
- Descuento total no puede exceder X% del precio base
- Margen m铆nimo debe ser Y%
- Comisi贸n se calcula sobre precio final despu茅s de descuentos</div>

        <h4>ServicioValidaci贸nVenta</h4>
        <div class="code-block">Responsabilidades:
- Validar que se cumplen todas las condiciones para venta
- Verificar disponibilidad de veh铆culo
- Validar documentaci贸n del cliente
- Verificar l铆mites de cr茅dito

M茅todos:
+ ValidarCondicionesVenta(ventaId): ValidationResult
+ VerificarDisponibilidadVeh铆culo(v铆n): bool
+ ValidarDocumentaci贸nCompleta(clienteId): ValidationResult
+ ValidarL铆mitesCr茅dito(clienteId, montoSolicitado): Result

Reglas de Negocio:
- Venta no puede proceder sin documentaci贸n completa
- Veh铆culo debe estar en estado "Disponible" o "Reservado"
- Si requiere financiaci贸n, debe tener aprobaci贸n crediticia</div>

        <h4>ServicioPromoci贸n</h4>
        <div class="code-block">Responsabilidades:
- Determinar promociones aplicables
- Calcular beneficios de promociones
- Validar elegibilidad del cliente
- Gestionar compatibilidad entre promociones

M茅todos:
+ ObtenerPromocionesVigentes(fechaActual): List&lt;Promoci贸n&gt;
+ ValidarElegibilidad(clienteId, promoci贸n): bool
+ CalcularBeneficio(precio, promoci贸n): Descuento
+ ValidarCompatibilidad(promoci贸n1, promoci贸n2): bool

Reglas de Negocio:
- Cliente debe cumplir requisitos espec铆ficos de promoci贸n
- Algunas promociones no son acumulables
- Vigencia debe ser validada al momento de aplicar</div>

        <h3>4.3 Servicios de Infraestructura</h3>

        <h4>ServicioNotificaci贸n</h4>
        <div class="code-block">Responsabilidades:
- Enviar notificaciones a clientes y vendedores
- Gestionar templates de mensajes
- Tracking de notificaciones enviadas

M茅todos:
+ EnviarCotizaci贸n(clienteId, cotizaci贸n): Result
+ NotificarVentaConfirmada(ventaId): Result
+ AlertarVencimientoCotizaci贸n(cotizaci贸nId): Result
+ EnviarSeguimiento(clienteId, mensaje): Result</div>

        <h4>ServicioDocumento</h4>
        <div class="code-block">Responsabilidades:
- Generar documentos PDF de cotizaciones y contratos
- Almacenar documentos generados
- Gestionar firmas digitales

M茅todos:
+ GenerarPDFCotizaci贸n(cotizaci贸nId): Document
+ GenerarContratoPDF(ventaId): Document
+ AlmacenarDocumento(documento, metadata): DocumentId
+ SolicitarFirmaDigital(documentId, firmantes): Result</div>

        <div class="highlight">
            <h4> Resumen de Dependencias Entre Servicios</h4>
            <p><strong>ServicioCotizaci贸n</strong> depende de: ServicioCalculoPrecio, ServicioPromoci贸n</p>
            <p><strong>ServicioVenta</strong> depende de: ServicioCotizaci贸n, ServicioValidaci贸nVenta, ServicioNotificaci贸n, ServicioDocumento</p>
            <p><strong>ServicioTradeIn</strong> depende de: ServicioCalculoPrecio, ServicioValidaci贸nVenta</p>
            <p><strong>ServicioPromoci贸n</strong> depende de: ServicioValidaci贸nVenta</p>
        </div>
    </div>

    <div class="header" style="margin-top: 50px; border-top: 3px solid #2c3e50; border-bottom: none;">
        <p style="color: #7f8c8d; font-size: 12px;">
            Documento generado siguiendo principios de Domain-Driven Design (DDD)<br>
            Bounded Context: Ventas | Concesionario de Veh铆culos
        </p>
    </div>

</body>
</html>