<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dominio de Ventas - An치lisis DDD</title>
    <style>
        @page {
            size: A4;
            margin: 2.5cm;
        }
        
        body {
            font-family: 'Calibri', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 21cm;
            margin: 0 auto;
            padding: 20px;
            background: white;
        }
        
        .header {
            text-align: center;
            border-bottom: 3px solid #2c3e50;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            color: #7f8c8d;
            font-size: 16px;
        }
        
        h2 {
            color: #2c3e50;
            font-size: 22px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
            margin-top: 30px;
            margin-bottom: 15px;
            page-break-after: avoid;
        }
        
        h3 {
            color: #34495e;
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
            page-break-after: avoid;
        }
        
        h4 {
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 15px;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            page-break-inside: avoid;
            font-size: 11px;
        }
        
        table th {
            background-color: #3498db;
            color: white;
            padding: 10px;
            text-align: left;
            font-weight: bold;
        }
        
        table td {
            border: 1px solid #bdc3c7;
            padding: 8px;
            vertical-align: top;
        }
        
        table tr:nth-child(even) {
            background-color: #ecf0f1;
        }
        
        .code-block {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            white-space: pre-wrap;
            page-break-inside: avoid;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .toc {
            background-color: #ecf0f1;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .toc h2 {
            border: none;
            margin-top: 0;
        }
        
        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        .toc li {
            padding: 5px 0;
        }
        
        .toc a {
            color: #2c3e50;
            text-decoration: none;
        }
        
        .toc a:hover {
            color: #3498db;
            text-decoration: underline;
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 10px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        
        .button-container {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #ecf0f1;
            border-radius: 5px;
        }
        
        .download-btn {
            background-color: #3498db;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        
        .download-btn:hover {
            background-color: #2980b9;
        }
        
        @media print {
            body {
                padding: 0;
            }
            
            .button-container {
                display: none;
            }
            
            h2, h3 {
                page-break-after: avoid;
            }
            
            table, .code-block {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Dominio de Ventas</h1>
        <div class="subtitle">An치lisis Completo - Domain-Driven Design</div>
        <div class="subtitle">Concesionario de Veh칤culos</div>
    </div>

    <div class="button-container">
        <button class="download-btn" onclick="window.print()">游늯 Imprimir / Guardar como PDF</button>
    </div>

    <div class="toc">
        <h2>Tabla de Contenidos</h2>
        <ul>
            <li><a href="#glosario">1. Glosario de T칠rminos de Negocio (Lenguaje Ubicuo)</a></li>
            <li><a href="#objetos-valor">2. Objetos de Valor del Dominio</a></li>
            <li><a href="#eventos">3. Triggers y Eventos del Dominio</a></li>
            <li><a href="#servicios">4. Servicios del Dominio</a></li>
        </ul>
    </div>

    <div class="section" id="glosario">
        <h2>1. Glosario de T칠rminos de Negocio (Lenguaje Ubicuo)</h2>
        
        <table>
            <thead>
                <tr>
                    <th style="width: 20%">T칠rmino</th>
                    <th style="width: 45%">Definici칩n</th>
                    <th style="width: 35%">Contexto de Uso</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Cliente</strong></td>
                    <td>Persona f칤sica o jur칤dica que est치 interesada en adquirir un veh칤culo o que ya ha realizado una compra</td>
                    <td>Identificaci칩n y seguimiento durante todo el proceso de venta</td>
                </tr>
                <tr>
                    <td><strong>Cotizaci칩n</strong></td>
                    <td>Documento que detalla el precio estimado de un veh칤culo con sus accesorios, incluyendo descuentos y condiciones de pago</td>
                    <td>Generada durante la negociaci칩n con el cliente</td>
                </tr>
                <tr>
                    <td><strong>Trade-in</strong></td>
                    <td>Veh칤culo usado que el cliente entrega como parte de pago para la adquisici칩n de un veh칤culo nuevo o seminuevo</td>
                    <td>Evaluado y valorado para ajustar el precio final</td>
                </tr>
                <tr>
                    <td><strong>AutoConfigurado</strong></td>
                    <td>Veh칤culo personalizado seg칰n las preferencias del cliente (color, accesorios, opcionales)</td>
                    <td>Resultado de la configuraci칩n durante el proceso de venta</td>
                </tr>
                <tr>
                    <td><strong>Reserva</strong></td>
                    <td>Compromiso temporal del cliente para apartar un veh칤culo espec칤fico del inventario</td>
                    <td>Requiere confirmaci칩n del inventario y posible adelanto</td>
                </tr>
                <tr>
                    <td><strong>Venta</strong></td>
                    <td>Transacci칩n comercial formalizada mediante la cual se transfiere la propiedad de un veh칤culo al cliente</td>
                    <td>Genera obligaciones de entrega y pago</td>
                </tr>
                <tr>
                    <td><strong>ContratoVenta</strong></td>
                    <td>Documento legal que establece los t칠rminos y condiciones de la transacci칩n de venta</td>
                    <td>Vincula legalmente a las partes involucradas</td>
                </tr>
                <tr>
                    <td><strong>Margen</strong></td>
                    <td>Diferencia entre el precio de venta y el costo de adquisici칩n del veh칤culo</td>
                    <td>Indicador clave de rentabilidad</td>
                </tr>
                <tr>
                    <td><strong>Descuento</strong></td>
                    <td>Reducci칩n aplicada al precio de venta seg칰n pol칤ticas comerciales o negociaci칩n</td>
                    <td>Sujeto a reglas de autorizaci칩n seg칰n monto</td>
                </tr>
                <tr>
                    <td><strong>Comisi칩n</strong></td>
                    <td>Porcentaje o monto fijo que recibe el vendedor por cerrar una venta</td>
                    <td>Calculada seg칰n pol칤ticas de compensaci칩n</td>
                </tr>
                <tr>
                    <td><strong>Precio Base</strong></td>
                    <td>Precio de referencia del veh칤culo sin configuraciones adicionales</td>
                    <td>Punto de partida para la cotizaci칩n</td>
                </tr>
                <tr>
                    <td><strong>Configuraci칩n</strong></td>
                    <td>Conjunto de opciones y accesorios seleccionados para personalizar el veh칤culo</td>
                    <td>Impacta el precio final</td>
                </tr>
                <tr>
                    <td><strong>Financiaci칩n</strong></td>
                    <td>Modalidad de pago que permite al cliente adquirir el veh칤culo mediante un cr칠dito</td>
                    <td>Opcional, requiere aprobaci칩n crediticia</td>
                </tr>
                <tr>
                    <td><strong>Promoci칩n</strong></td>
                    <td>Oferta especial temporal que incluye beneficios adicionales o descuentos</td>
                    <td>Aplica seg칰n vigencia y condiciones</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="section" id="objetos-valor">
        <h2>2. Objetos de Valor del Dominio</h2>

        <h3>2.1 Precio</h3>
        <div class="code-block">Atributos:
- MontoBase: decimal
- Moneda: string (COP, USD)
- Descuentos: List&lt;Descuento&gt;
- ImpuestosIncluidos: List&lt;Impuesto&gt;
- PrecioFinal: decimal (calculado)

Invariantes:
- PrecioFinal debe ser mayor a cero
- La suma de descuentos no puede exceder el precio base
- Moneda debe ser v치lida seg칰n configuraci칩n regional</div>

        <h3>2.2 DatosVeh칤culo</h3>
        <div class="code-block">Atributos:
- VIN: string (칰nico, 17 caracteres)
- Marca: string
- Modelo: string
- A침o: int
- Color: string
- Kilometraje: int
- EstadoCondici칩n: enum (Nuevo, Seminuevo, Usado)

Invariantes:
- VIN debe ser v치lido seg칰n est치ndar internacional
- A침o debe estar entre 1900 y a침o actual + 1
- Kilometraje no puede ser negativo</div>

        <h3>2.3 Configuraci칩nVeh칤culo</h3>
        <div class="code-block">Atributos:
- ColorExterior: string
- ColorInterior: string
- Accesorios: List&lt;Accesorio&gt;
- PaquetesOpcionales: List&lt;Paquete&gt;
- PrecioAdicional: decimal (calculado)

Invariantes:
- Accesorios deben ser compatibles con el modelo
- No puede haber accesorios duplicados</div>

        <h3>2.4 ValorTradeIn</h3>
        <div class="code-block">Atributos:
- Veh칤culoEntregado: DatosVeh칤culo
- ValorEstimado: decimal
- ValorAceptado: decimal
- FechaEvaluaci칩n: DateTime
- EstadoEvaluaci칩n: enum (Pendiente, Aceptado, Rechazado)

Invariantes:
- ValorAceptado <= ValorEstimado
- FechaEvaluaci칩n no puede ser futura
- ValorEstimado debe ser mayor a cero</div>

        <h3>2.5 RangoFechas</h3>
        <div class="code-block">Atributos:
- FechaInicio: DateTime
- FechaFin: DateTime

Invariantes:
- FechaFin debe ser posterior a FechaInicio
- Ambas fechas deben ser v치lidas</div>

        <h3>2.6 DatosContacto</h3>
        <div class="code-block">Atributos:
- TipoContacto: enum (Email, Tel칠fono, Celular)
- Valor: string
- EsPrincipal: bool
- Verificado: bool

Invariantes:
- Formato debe ser v치lido seg칰n TipoContacto
- Debe existir al menos un contacto principal</div>

        <h3>2.7 CondicionesPago</h3>
        <div class="code-block">Atributos:
- TipoPago: enum (Contado, Financiado, Mixto)
- MontoInicial: decimal
- PorcentajeInicial: decimal
- RequiereFinanciaci칩n: bool
- Plazo: int (meses, si aplica)

Invariantes:
- MontoInicial >= 0
- Si TipoPago es Contado, MontoInicial debe ser 100% del precio
- Si es Financiado, MontoInicial debe ser al menos el m칤nimo establecido</div>
    </div>

    <div class="section" id="eventos">
        <h2>3. Triggers y Eventos del Dominio</h2>

        <h3>3.1 Eventos de Entrada (Inbound)</h3>
        <table>
            <thead>
                <tr>
                    <th style="width: 25%">Evento</th>
                    <th style="width: 15%">Origen</th>
                    <th style="width: 30%">Datos</th>
                    <th style="width: 30%">Acci칩n Desencadenada</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Veh칤culoListoParaVenta</strong></td>
                    <td>Inventario</td>
                    <td>VIN, EstadoStock, PrecioSugerido</td>
                    <td>Habilitar veh칤culo en cat치logo de ventas</td>
                </tr>
                <tr>
                    <td><strong>AprobacionCr칠dito</strong></td>
                    <td>Financiaci칩n</td>
                    <td>ClienteId, MontoAprobado, Plazo, TasaInter칠s</td>
                    <td>Continuar con formalizaci칩n de venta</td>
                </tr>
                <tr>
                    <td><strong>DatosCliente</strong></td>
                    <td>CRM</td>
                    <td>ClienteId, Nombre, Contacto, HistorialCompras</td>
                    <td>Cargar informaci칩n del cliente en cotizaci칩n</td>
                </tr>
                <tr>
                    <td><strong>RechazoCr칠dito</strong></td>
                    <td>Financiaci칩n</td>
                    <td>ClienteId, MotivoRechazo</td>
                    <td>Notificar al vendedor y cliente, ofrecer alternativas</td>
                </tr>
            </tbody>
        </table>

        <h3>3.2 Eventos de Salida (Outbound)</h3>
        <table>
            <thead>
                <tr>
                    <th style="width: 25%">Evento</th>
                    <th style="width: 20%">Destino</th>
                    <th style="width: 30%">Datos</th>
                    <th style="width: 25%">Prop칩sito</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Cotizaci칩nGenerada</strong></td>
                    <td>CRM, Cliente</td>
                    <td>Cotizaci칩nId, Veh칤culoId, PrecioTotal, Vigencia</td>
                    <td>Registro y seguimiento de propuesta comercial</td>
                </tr>
                <tr>
                    <td><strong>ReservarStock</strong></td>
                    <td>Inventario</td>
                    <td>VIN, ClienteId, FechaReserva, Duraci칩nReserva</td>
                    <td>Apartar veh칤culo temporalmente</td>
                </tr>
                <tr>
                    <td><strong>SolicitudCr칠dito</strong></td>
                    <td>Financiaci칩n</td>
                    <td>ClienteId, MontoSolicitado, Plazo, Veh칤culoId</td>
                    <td>Iniciar evaluaci칩n crediticia</td>
                </tr>
                <tr>
                    <td><strong>VentaConfirmada</strong></td>
                    <td>Finanzas, Entrega, Inventario, CRM</td>
                    <td>VentaId, ClienteId, VIN, MontoTotal, FormaPago</td>
                    <td>Activar procesos de cobro y entrega</td>
                </tr>
                <tr>
                    <td><strong>Cotizaci칩nVencida</strong></td>
                    <td>CRM</td>
                    <td>Cotizaci칩nId, ClienteId</td>
                    <td>Liberar reserva, actualizar pipeline de ventas</td>
                </tr>
                <tr>
                    <td><strong>TradeInEvaluado</strong></td>
                    <td>Inventario, Recepci칩n</td>
                    <td>Veh칤culoTradeIn, ValorAceptado, Estado</td>
                    <td>Registrar ingreso potencial de veh칤culo usado</td>
                </tr>
                <tr>
                    <td><strong>VentaCancelada</strong></td>
                    <td>Inventario, Finanzas, CRM</td>
                    <td>VentaId, Motivo</td>
                    <td>Liberar reserva, reversar registros</td>
                </tr>
            </tbody>
        </table>

        <h3>3.3 Triggers Internos</h3>
        <table>
            <thead>
                <tr>
                    <th style="width: 30%">Trigger</th>
                    <th style="width: 35%">Condici칩n</th>
                    <th style="width: 35%">Acci칩n</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>ValidarDisponibilidad</strong></td>
                    <td>Cliente selecciona veh칤culo</td>
                    <td>Consultar a Inventario si est치 disponible</td>
                </tr>
                <tr>
                    <td><strong>CalcularPrecioFinal</strong></td>
                    <td>Se modifica configuraci칩n o descuentos</td>
                    <td>Recalcular precio total de cotizaci칩n</td>
                </tr>
                <tr>
                    <td><strong>AplicarPromoci칩n</strong></td>
                    <td>Fecha actual dentro de vigencia de promoci칩n</td>
                    <td>Aplicar descuentos o beneficios autom치ticamente</td>
                </tr>
                <tr>
                    <td><strong>RequiereAutorizaci칩n</strong></td>
                    <td>Descuento excede l칤mite permitido</td>
                    <td>Enviar solicitud a supervisor</td>
                </tr>
                <tr>
                    <td><strong>NotificarVigencia</strong></td>
                    <td>Quedan 24h para vencimiento de cotizaci칩n</td>
                    <td>Alertar a vendedor y cliente</td>
                </tr>
                <tr>
                    <td><strong>EvaluarTradeIn</strong></td>
                    <td>Cliente solicita valoraci칩n</td>
                    <td>Crear orden de inspecci칩n para veh칤culo usado</td>
                </tr>
                <tr>
                    <td><strong>ValidarDocumentaci칩n</strong></td>
                    <td>Antes de confirmar venta</td>
                    <td>Verificar documentos requeridos del cliente</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="section" id="servicios">
        <h2>4. Servicios del Dominio</h2>

        <h3>4.1 Servicios de Aplicaci칩n</h3>

        <h4>ServicioCotizaci칩n</h4>
        <div class="code-block">Responsabilidades:
- Crear nueva cotizaci칩n
- Calcular precio total con configuraciones y descuentos
- Aplicar promociones vigentes
- Validar vigencia de cotizaci칩n
- Generar documento de cotizaci칩n

M칠todos:
+ CrearCotizaci칩n(clienteId, veh칤culoId, configuraci칩n): Cotizaci칩nId
+ CalcularPrecioTotal(cotizaci칩nId): Precio
+ AplicarDescuento(cotizaci칩nId, descuento): Result
+ RegenerarCotizaci칩n(cotizaci칩nId): Cotizaci칩n
+ ObtenerCotizacionesVigentes(clienteId): List&lt;Cotizaci칩n&gt;

Dependencias:
- Repositorio de Cotizaciones
- Servicio de Precios
- Servicio de Promociones
- Cliente API (CRM)</div>

        <h4>ServicioVenta</h4>
        <div class="code-block">Responsabilidades:
- Procesar venta completa
- Validar condiciones de venta
- Coordinar con otros bounded contexts
- Generar contrato de venta
- Gestionar estados de la venta

M칠todos:
+ IniciarVenta(cotizaci칩nId): VentaId
+ ConfirmarVenta(ventaId, condicionesPago): Result
+ CancelarVenta(ventaId, motivo): Result
+ ObtenerEstadoVenta(ventaId): EstadoVenta
+ GenerarContrato(ventaId): ContratoVenta

Dependencias:
- Repositorio de Ventas
- Servicio de Cotizaci칩n
- Inventario API
- Financiaci칩n API
- Finanzas API</div>

        <h4>ServicioTradeIn</h4>
        <div class="code-block">Responsabilidades:
- Gestionar evaluaci칩n de veh칤culos en trade-in
- Calcular valor de mercado
- Ajustar precio de venta
- Coordinar recepci칩n del veh칤culo usado

M칠todos:
+ SolicitarEvaluaci칩n(veh칤culoUsado, ventaId): Evaluaci칩nId
+ RegistrarValorEstimado(evaluaci칩nId, valor): Result
+ AceptarTradeIn(evaluaci칩nId, valorFinal): Result
+ AjustarPrecioVenta(ventaId, valorTradeIn): Precio

Dependencias:
- Repositorio de TradeIns
- Servicio de Precios
- Inspecci칩n API
- Recepci칩n API</div>

        <h3>4.2 Servicios de Dominio</h3>

        <h4>ServicioCalculoPrecio</h4>
        <div class="code-block">Responsabilidades:
- Calcular precio final con todas las variables
- Aplicar reglas de descuento
- Validar m치rgenes m칤nimos
- Calcular comisiones

M칠todos:
+ CalcularPrecioFinal(precioBase, configuraci칩n, descuentos, tradeIn): Precio
+ ValidarDescuento(descuento, precioBase, pol칤ticasVigentes): Result
+ CalcularMargen(precioVenta, costoAdquisici칩n): Margen
+ CalcularComisi칩n(precioVenta, reglaComisi칩n): Monto

Reglas de Negocio:
- Descuento total no puede exceder X% del precio base
- Margen m칤nimo debe ser Y%
- Comisi칩n se calcula sobre precio final despu칠s de descuentos</div>

        <h4>ServicioValidaci칩nVenta</h4>
        <div class="code-block">Responsabilidades:
- Validar que se cumplen todas las condiciones para venta
- Verificar disponibilidad de veh칤culo
- Validar documentaci칩n del cliente
- Verificar l칤mites de cr칠dito

M칠todos:
+ ValidarCondicionesVenta(ventaId): ValidationResult
+ VerificarDisponibilidadVeh칤culo(v칤n): bool
+ ValidarDocumentaci칩nCompleta(clienteId): ValidationResult
+ ValidarL칤mitesCr칠dito(clienteId, montoSolicitado): Result

Reglas de Negocio:
- Venta no puede proceder sin documentaci칩n completa
- Veh칤culo debe estar en estado "Disponible" o "Reservado"
- Si requiere financiaci칩n, debe tener aprobaci칩n crediticia</div>

        <h4>ServicioPromoci칩n</h4>
        <div class="code-block">Responsabilidades:
- Determinar promociones aplicables
- Calcular beneficios de promociones
- Validar elegibilidad del cliente
- Gestionar compatibilidad entre promociones

M칠todos:
+ ObtenerPromocionesVigentes(fechaActual): List&lt;Promoci칩n&gt;
+ ValidarElegibilidad(clienteId, promoci칩n): bool
+ CalcularBeneficio(precio, promoci칩n): Descuento
+ ValidarCompatibilidad(promoci칩n1, promoci칩n2): bool

Reglas de Negocio:
- Cliente debe cumplir requisitos espec칤ficos de promoci칩n
- Algunas promociones no son acumulables
- Vigencia debe ser validada al momento de aplicar</div>

        <h3>4.3 Servicios de Infraestructura</h3>

        <h4>ServicioNotificaci칩n</h4>
        <div class="code-block">Responsabilidades:
- Enviar notificaciones a clientes y vendedores
- Gestionar templates de mensajes
- Tracking de notificaciones enviadas

M칠todos:
+ EnviarCotizaci칩n(clienteId, cotizaci칩n): Result
+ NotificarVentaConfirmada(ventaId): Result
+ AlertarVencimientoCotizaci칩n(cotizaci칩nId): Result
+ EnviarSeguimiento(clienteId, mensaje): Result</div>

        <h4>ServicioDocumento</h4>
        <div class="code-block">Responsabilidades:
- Generar documentos PDF de cotizaciones y contratos
- Almacenar documentos generados
- Gestionar firmas digitales

M칠todos:
+ GenerarPDFCotizaci칩n(cotizaci칩nId): Document
+ GenerarContratoPDF(ventaId): Document
+ AlmacenarDocumento(documento, metadata): DocumentId
+ SolicitarFirmaDigital(documentId, firmantes): Result</div>

        <div class="highlight">
            <h4>游늵 Resumen de Dependencias Entre Servicios</h4>
            <p><strong>ServicioCotizaci칩n</strong> depende de: ServicioCalculoPrecio, ServicioPromoci칩n</p>
            <p><strong>ServicioVenta</strong> depende de: ServicioCotizaci칩n, ServicioValidaci칩nVenta, ServicioNotificaci칩n, ServicioDocumento</p>
            <p><strong>ServicioTradeIn</strong> depende de: ServicioCalculoPrecio, ServicioValidaci칩nVenta</p>
            <p><strong>ServicioPromoci칩n</strong> depende de: ServicioValidaci칩nVenta</p>
        </div>
    </div>

    <div class="header" style="margin-top: 50px; border-top: 3px solid #2c3e50; border-bottom: none;">
        <p style="color: #7f8c8d; font-size: 12px;">
            Documento generado siguiendo principios de Domain-Driven Design (DDD)<br>
            Bounded Context: Ventas | Concesionario de Veh칤culos
        </p>
    </div>

</body>
</html>